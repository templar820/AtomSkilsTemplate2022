FROM node:14.19.0-buster AS build-stage

ARG ESLINT_NO_DEV_ERRORS
ARG DISABLE_ESLINT_PLUGIN
ARG CI
ARG TSC_COMPILE_ON_ERROR
ARG REACT_APP_ENDPOINT_PRODUCTION
ARG REACT_APP_SWAGGER_ENDPOINT


ADD /frontend /frontend
WORKDIR /frontend

RUN npm install --legacy-peer-deps





ENV ESLINT_NO_DEV_ERRORS ${ESLINT_NO_DEV_ERRORS}
ENV DISABLE_ESLINT_PLUGIN ${DISABLE_ESLINT_PLUGIN}
ENV CI ${CI}
ENV TSC_COMPILE_ON_ERROR ${TSC_COMPILE_ON_ERROR}
ENV REACT_APP_ENDPOINT_PRODUCTION ${REACT_APP_ENDPOINT_PRODUCTION}
ENV REACT_APP_SWAGGER_ENDPOINT ${REACT_APP_SWAGGER_ENDPOINT}

RUN npm run build


FROM nginx:latest
COPY --from=build-stage /frontend/build/ /usr/share/nginx/html
COPY _docker/nginx/nginx.conf /etc/nginx/conf.d/default.conf